

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Load Stage Design &mdash; Kids First Data Ingest Libraries  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Warehousing" href="warehousing.html" />
    <link rel="prev" title="Transform Stage" href="transform.html" />
    <link rel="stylesheet" href="https://kids-first.github.io/kf-sphinx-docs-theme/sphinx_kidsfirst_theme/static/css/kidsfirst.css" type="text/css" />
 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Design Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="value_principles.html">Value Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="extract_mapping.html">Extract Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform.html">Transform Stage</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Load Stage Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="warehousing.html">Remote Warehousing</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">Logs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kids First Data Ingest Libraries</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="overview.html">Design Overview</a> &raquo;</li>
        
      <li>Load Stage Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/design/load.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="load-stage-design">
<span id="design-load"></span><h1>Load Stage Design<a class="headerlink" href="#load-stage-design" title="Permalink to this headline">¶</a></h1>
<p>The load stage is responsible for taking your transformed data and sending it
to the target service in the right format. It receives sets of records where
each set contains all of the necessary values for populating a kind of entity
in the target service, and it produces a series of service requests to make
service additions or updates.</p>
<p>To do that, the Load stage feeds data records through a plugin interface that
must be implemented for each target service.</p>
<p>Target service plugins implement the necessary routines for converting record
data coming in from the previous stages into message payloads and also
implement the logic for sending those payloads to the target service.</p>
<img alt="Diagram showing how the load stage hooks into target service plugins" src="../_images/load_stage.svg" /><p><strong>The plugin includes a builder class for each kind of entity that it wants to
send to the target service.</strong></p>
<p>Each builder class implements methods for the following behaviors:</p>
<ol class="arabic">
<li><p>(optional) Transform the given records list into whatever new record
format the entity builder needs.</p></li>
<li><p>Compose the entity’s uniquely identifying primary elements.</p>
<blockquote>
<div><p>This is used for querying a local cache or the target service to fetch the
identifier of an existing entity that has the given values, if one exists,
so that entities can be repeatably identified for updates. (Target
services often don’t do this equivalent entity replacement themselves.)</p>
</div></blockquote>
</li>
<li><p>Query the target service for the target identifier of the entity with the
the same primary elements.</p>
<blockquote>
<div><p>If no entry exists in the local cache, we have to query the target server
for guidance so that entities can be repeatedly identified for updates.</p>
</div></blockquote>
</li>
<li><p>Build a complete message payload that will be sent to the server to
populate a new (or updated) entity of its type.</p></li>
</ol>
<p>For more details, read <a class="reference internal" href="../tutorial/target_service_plugins/how_to_make.html#tutorial-make-target-service-plugin"><span class="std std-ref">Making a Target Service Plugin</span></a></p>
<hr class="docutils" />
<p><strong>A note on Unique Entity Identification</strong></p>
<p>It may be easier to understand the concept and purpose of uniquely identifying
components with an example.</p>
<p>Given the record:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>STUDY.TARGET_SERVICE_ID</p></th>
<th class="head"><p>PARTICIPANT.ID</p></th>
<th class="head"><p>PARTICIPANT.AGE</p></th>
<th class="head"><p>PARTICIPANT.SEX</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SD_12345678</p></td>
<td><p>P1</p></td>
<td><p>17</p></td>
<td><p>Male</p></td>
</tr>
</tbody>
</table>
<p>We might wish to compose a participant entity that looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;study_id&quot;</span><span class="p">:</span> <span class="s2">&quot;SD_12345678&quot;</span><span class="p">,</span>
    <span class="nt">&quot;external_id&quot;</span><span class="p">:</span> <span class="s2">&quot;P1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;age&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="nt">&quot;sex&quot;</span><span class="p">:</span> <span class="s2">&quot;Male&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because we know that every participant external ID is guaranteed to be unique
within a study and that age and sex are merely characteristic observations of
the participant that can be updated later, the uniquely identifying components
for this participant would be: <code class="docutils literal notranslate"><span class="pre">{&quot;study_id&quot;:</span> <span class="pre">&quot;SD_12345678&quot;,</span> <span class="pre">&quot;external_id&quot;:</span>
<span class="pre">&quot;P1&quot;}</span></code>.</p>
<p>Any future corrections to the participant’s age or sex should be
associated with the same entry. So how do we ensure that?</p>
<p>Let’s say that, after submission to the target service, the returned identifier
for the participant entity is: <code class="docutils literal notranslate"><span class="pre">&quot;PT_00001111&quot;</span></code>. The ingest library will
internally create an association in a local cache file relating the unique key
components with the resulting target identifier like this:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 77%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>participants</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Unique Components</p></th>
<th class="head"><p>Target ID</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>{“study_id”: “SD_12345678”, “external_id”: “P1”}</p></td>
<td><p>PT_00001111</p></td>
</tr>
</tbody>
</table>
<p>If the ingest library later encounters a record in the source data with the
same unique components, it can:</p>
<ol class="arabic simple">
<li><p>Check the local cache for a known identifer.</p></li>
<li><p>If no related entry exists in the local cache, query the target service for
the identifer of the entity with the same key values.</p></li>
</ol>
<p>That way we can update characteristics of existing entities without knowing in
advance how the target service identifies them, and it should always be safe to
erase the local cache at the expense of performance (additional network
roundtrips).</p>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="warehousing.html" class="btn btn-neutral float-right" title="Remote Warehousing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="transform.html" class="btn btn-neutral float-left" title="Transform Stage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Kids First

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>