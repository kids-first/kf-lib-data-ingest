

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Load Stage Design &mdash; Kids First Data Ingest Libraries  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How To" href="../tutorial/index.html" />
    <link rel="prev" title="Remote Warehousing" href="warehousing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Design Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="value_principles.html">Value Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="extract_mapping.html">Extract Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform.html">Transform Stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="warehousing.html">Remote Warehousing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Load Stage Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">How To</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kids First Data Ingest Libraries</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="overview.html">Design Overview</a> &raquo;</li>
        
      <li>Load Stage Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/design/load.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="load-stage-design">
<span id="design-load"></span><h1>Load Stage Design<a class="headerlink" href="#load-stage-design" title="Permalink to this headline">¶</a></h1>
<p>The load stage is responsible for taking your transformed data and sending it
to the target service in the right format. It receives sets of records where
each set contains all of the necessary values for populating a kind of entity
in the target service, and it produces a series of service requests to make
service additions or updates.</p>
<p>To do that, the Load stage feeds data records through a plugin interface that
must be implemented for each target service.</p>
<p>Target service plugins implement the necessary routines for converting record
data coming in from the previous stages into message payloads and also
implement the logic for sending those payloads to the target service.</p>
<img alt="Diagram showing how the load stage hooks into target service plugins" src="../_images/load_stage.svg" /><p><strong>The plugin includes a builder class for each kind of entity that it wants to
send to the target service.</strong></p>
<p>Each builder class implements methods for the following behaviors:</p>
<ol class="arabic simple">
<li>(optional) <strong>Transform the given records list into whatever new record
format the entity builder needs</strong>.</li>
<li>(soon to be optional) <strong>Compose a unique keystring from the entity’s primary
constituent elements</strong>. This is used internally for caching identifiers
assigned by the target service (received from the target service as part of
the response for sending an entity payload) so that they can be repeatably
assigned to the same entities again. (Target services often don’t do this
themselves.)</li>
<li><strong>Build a message payload that will be sent to the server to populate a new
(or updated) entity of its type</strong>. The unique keystrings generated in the
previous steps are passed to this method as well so that they can be
included as part of the payload if desired.</li>
</ol>
<p>For more details, read <a class="reference internal" href="../tutorial/target_service_plugins/how_to_make.html#tutorial-make-target-service-plugin"><span class="std std-ref">Making a Target Service Plugin</span></a></p>
<hr class="docutils" />
<p><strong>A Note on the ID Cache</strong></p>
<p>It may be easier to understand the purpose of the ID cache and
unique keys with an example.</p>
<p>Given the record:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">PARTICIPANT.ID</th>
<th class="head">PHENOTYPE.NAME</th>
<th class="head">PHENOTYPE.EVENT_AGE_DAYS</th>
<th class="head">PHENOTYPE.OBSERVED</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>P1</td>
<td>Cleft Ear</td>
<td>765</td>
<td>Positive</td>
</tr>
</tbody>
</table>
<p>The unique keystring for the phenotype observation in this record could be:
<code class="docutils literal notranslate"><span class="pre">&quot;p1__cleft-ear__765&quot;</span></code>. (Assume that participant P1 is not Schrödinger’s cat
and can only be either positive or negative for that characteristic at that
time, but not both simultaneously.)</p>
<p>And, after submission to the target service, the returned identifier for the
phenotype observation entity might be something like: <code class="docutils literal notranslate"><span class="pre">&quot;PH_00001111&quot;</span></code>.</p>
<p>The ingest library will internally create an entry in an ID cache for the
current target service URL which associates this unique key with its target
identifier like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">phenotypes</th>
</tr>
<tr class="row-even"><th class="head">Unique Key</th>
<th class="head">Target ID</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>p1__cleft-ear__765</td>
<td>PH_00001111</td>
</tr>
</tbody>
</table>
<p>Then whenever the ingest library sees a record in the source data with the
unique key components above, it will always associate the resulting phenotype
observation with the unique keystring <code class="docutils literal notranslate"><span class="pre">&quot;p1__cleft-ear__765&quot;</span></code> which will
always point to the phenotype observation entity in the target service
identified by <code class="docutils literal notranslate"><span class="pre">&quot;PH_00001111&quot;</span></code>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorial/index.html" class="btn btn-neutral float-right" title="How To" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="warehousing.html" class="btn btn-neutral float-left" title="Remote Warehousing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Kids First

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>