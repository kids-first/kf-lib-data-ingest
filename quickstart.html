

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart &mdash; Kids First Data Ingest Libraries  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/other.css" type="text/css" />
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Design Overview" href="design/overview.html" />
    <link rel="prev" title="Installation" href="install.html" />
    <link rel="stylesheet" href="https://kids-first.github.io/kf-sphinx-docs-theme/sphinx_kidsfirst_theme/static/css/kidsfirst.css" type="text/css" />
 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generate-a-new-ingest-package">Generate a new ingest package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test">Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-another-extract-config">Add another extract config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modify-the-transform-module">Modify the Transform module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-again">Test Again</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="design/overview.html">Design Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kids First Data Ingest Libraries</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="quickstart">
<span id="id1"></span><h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>If you want to get up and running quickly with creating an ingest package
and running it, then the quick start guide is the best place to start. It’s ok
if you do not understand what each of the steps are doing. The tutorial
section goes through the exact same demonstration, but it includes detailed
explanations for each step.</p>
<section id="generate-a-new-ingest-package">
<h2>Generate a new ingest package<a class="headerlink" href="#generate-a-new-ingest-package" title="Permalink to this headline">¶</a></h2>
<p>Each study that needs to be ingested will have a single outer directory and one
or more inner directories that each contain the configuration files needed by
the ingest pipeline to extract, transform, and load parts of the study into a
target data store or service. The inner directories are known as the ingest
packages.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We want to have an outer directory for each study, because we often need
multiple ingest packages to complete an entire study for
practical/logistical reasons.</p>
</div>
<p>The first thing to do after installing the ingest library CLI is to create an
outer directory for a study named <code class="docutils literal notranslate"><span class="pre">my_study</span></code> and inside it a new ingest
package named <code class="docutils literal notranslate"><span class="pre">ingest_package_1</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ kidsfirst new --dest_dir=my_study/ingest_package_1
</pre></div>
</div>
<p>Your new ingest package is extremely basic. It has 1 test source data file and
the Python modules needed to extract, clean, and transform the data for the
target service. If you look inside it, it will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>my_study/
└── ingest_package_1/
    ├── ingest_package_config.py
    ├── transform_module.py
    ├── data/
    │   └── clinical.tsv
    ├── extract_configs/
    │   └── extract_config.py
    └── tests/
        ├── conftest.py
        └── test_custom_counts.py
</pre></div>
</div>
<p>And the included test data looks like</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">my_study/ingest_package_1/data/clinical.tsv</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>family</p></th>
<th class="head"><p>subject</p></th>
<th class="head"><p>sample</p></th>
<th class="head"><p>analyte</p></th>
<th class="head"><p>diagnosis</p></th>
<th class="head"><p>gender</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>f1</p></td>
<td><p>PID001</p></td>
<td><p>SP001A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-odd"><td><p>f1</p></td>
<td><p>PID001</p></td>
<td><p>SP001B</p></td>
<td><p>rna (2)</p></td>
<td><p>cold</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-even"><td><p>f1</p></td>
<td><p>PID002</p></td>
<td><p>SP002A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-odd"><td><p>f1</p></td>
<td><p>PID002</p></td>
<td><p>SP002B</p></td>
<td><p>rna (2)</p></td>
<td><p>cold</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-even"><td><p>f1</p></td>
<td><p>PID003</p></td>
<td><p>SP003A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-odd"><td><p>f1</p></td>
<td><p>PID003</p></td>
<td><p>SP003B</p></td>
<td><p>rna (2)</p></td>
<td><p>cold</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-even"><td><p>f2</p></td>
<td><p>PID004</p></td>
<td><p>SP004A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-odd"><td><p>f2</p></td>
<td><p>PID004</p></td>
<td><p>SP004B</p></td>
<td><p>rna (2)</p></td>
<td><p>cold</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-even"><td><p>f2</p></td>
<td><p>PID005</p></td>
<td><p>SP005A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-odd"><td><p>f2</p></td>
<td><p>PID005</p></td>
<td><p>SP005B</p></td>
<td><p>rna (2)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-even"><td><p>f3</p></td>
<td><p>PID006</p></td>
<td><p>SP006</p></td>
<td><p>rna (2)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-odd"><td><p>f3</p></td>
<td><p>PID007</p></td>
<td><p>SP007</p></td>
<td><p>rna (2)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-even"><td><p>f3</p></td>
<td><p>PID008</p></td>
<td><p>SP008A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-odd"><td><p>f3</p></td>
<td><p>PID008</p></td>
<td><p>SP008B</p></td>
<td><p>rna (2)</p></td>
<td><p>flu</p></td>
<td><p>Female</p></td>
</tr>
<tr class="row-even"><td><p>f3</p></td>
<td><p>PID009</p></td>
<td><p>SP009A</p></td>
<td><p>dna (1)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
<tr class="row-odd"><td><p>f3</p></td>
<td><p>PID009</p></td>
<td><p>SP009B</p></td>
<td><p>rna (2)</p></td>
<td><p>flu</p></td>
<td><p>Male</p></td>
</tr>
</tbody>
</table>
</section>
<section id="test">
<h2>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>We can make sure everything works with the <code class="docutils literal notranslate"><span class="pre">test</span></code> command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ kidsfirst test my_study/ingest_package_1 --no_validate
</pre></div>
</div>
<p>The logs on your screen should indicate a successful unvalidated test run.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ kidsfirst test my_study/ingest_package_1 --no_validate
2020-11-27 11:39:26,161 - DataIngestPipeline - Thread: MainThread - WARNING - Ingest will run with validation disabled!
...
2020-11-27 11:39:26,575 - DataIngestPipeline - Thread: MainThread - INFO - Ingest skipped validation!
2020-11-27 11:39:26,575 - DataIngestPipeline - Thread: MainThread - INFO - ✅ Ingest pipeline completed execution!
2020-11-27 11:39:26,575 - DataIngestPipeline - Thread: MainThread - INFO - END data ingestion
</pre></div>
</div>
<p>If you scroll up through the log output, you should see that it pretends to
load families, participants, diagnoses, and biospecimens from clinical.tsv.</p>
</section>
<section id="add-another-extract-config">
<h2>Add another extract config<a class="headerlink" href="#add-another-extract-config" title="Permalink to this headline">¶</a></h2>
<p>We’re going to create a second extract config to extract data from the
following source data (different from the file you already have and stored in
the cloud):</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">family_and_phenotype.tsv</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
<th class="head"><p>[ignore]</p></th>
</tr>
<tr class="row-even"><th class="head"><p>[ignore]</p></th>
<th class="head"><p>participant</p></th>
<th class="head"><p>mother</p></th>
<th class="head"><p>father</p></th>
<th class="head"><p>gender</p></th>
<th class="head"><p>specimens</p></th>
<th class="head"><p>age (hrs)</p></th>
<th class="head"><p>CLEFT_EGO</p></th>
<th class="head"><p>CLEFT_ID</p></th>
<th class="head"><p>age (hrs)</p></th>
<th class="head"><p>EXTRA_EARDRUM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>[ignore]</p></td>
<td><p>PID001</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>F</p></td>
<td><p>SP001A,SP001B</p></td>
<td><p>4</p></td>
<td><p>TRUE</p></td>
<td><p>FALSE</p></td>
<td><p>4</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-even"><td><p>[ignore]</p></td>
<td><p>PID002</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP002A; SP002B</p></td>
<td><p>435</p></td>
<td><p>TRUE</p></td>
<td><p>FALSE</p></td>
<td><p>435</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-odd"><td><p>[ignore]</p></td>
<td><p>PID003</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP003A;SP003B</p></td>
<td><p>34</p></td>
<td><p>TRUE</p></td>
<td><p>FALSE</p></td>
<td><p>34</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-even"><td><p>[ignore]</p></td>
<td><p>PID004</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>M</p></td>
<td><p>SP004A; SP004B</p></td>
<td><p>4</p></td>
<td><p>TRUE</p></td>
<td><p>TRUE</p></td>
<td><p>4</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-odd"><td><p>[ignore]</p></td>
<td><p>PID005</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP005A, SP005B</p></td>
<td><p>345</p></td>
<td><p>TRUE</p></td>
<td><p>TRUE</p></td>
<td><p>34</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-even"><td><p>[ignore]</p></td>
<td><p>PID006</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP006</p></td>
<td><p>34</p></td>
<td><p>TRUE</p></td>
<td><p>TRUE</p></td>
<td><p>43545</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-odd"><td><p>[ignore]</p></td>
<td><p>PID007</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>M</p></td>
<td><p>SP007</p></td>
<td><p>34</p></td>
<td><p>TRUE</p></td>
<td><p>FALSE</p></td>
<td><p>5</p></td>
<td><p>TRUE</p></td>
</tr>
<tr class="row-even"><td><p>[ignore]</p></td>
<td><p>PID008</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP008A,SP008B</p></td>
<td><p>43545</p></td>
<td><p>TRUE</p></td>
<td><p>TRUE</p></td>
<td><p>52</p></td>
<td><p>TRUE</p></td>
</tr>
<tr class="row-odd"><td><p>[ignore]</p></td>
<td><p>PID009</p></td>
<td></td>
<td></td>
<td></td>
<td><p>SP009A,SP009B</p></td>
<td><p>5</p></td>
<td><p>FALSE</p></td>
<td><p>TRUE</p></td>
<td><p>25</p></td>
<td><p>TRUE</p></td>
</tr>
</tbody>
</table>
<p>Download the extract configuration for this new data
<a class="reference download internal" download="" href="_downloads/0e9d418c30dd6481f9e51ae418dccadb/family_and_phenotype.py"><code class="xref download docutils literal notranslate"><span class="pre">family_and_phenotype.py</span></code></a>
and put it in <code class="docutils literal notranslate"><span class="pre">my_study/ingest_package_1/extract_configs</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>my_study/
└── ingest_package_1/
    └── extract_configs/
       └── family_and_phenotype.py
</pre></div>
</div>
<p>The full tutorial has a detailed explanation of what this file does, but for
now the file should look like this:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">my_study/ingest_package_1/extract_configs/family_and_phenotype.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.common</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.common.concept_schema</span> <span class="kn">import</span> <span class="n">CONCEPT</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.common.pandas_utils</span> <span class="kn">import</span> <span class="n">Split</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.etl.extract.operations</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">source_data_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/kids-first/kf-lib-data-ingest/master/docs/data/family_and_phenotype.tsv&quot;</span>

<span class="n">source_data_read_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;[ignore]&quot;</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">observed_yes_no</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">OBSERVED</span><span class="o">.</span><span class="n">YES</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">OBSERVED</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">}:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">value_map</span><span class="p">(</span>
        <span class="n">in_col</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span>
        <span class="n">m</span><span class="o">=</span><span class="p">{</span>
            <span class="sa">r</span><span class="s2">&quot;PID(\d+)&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>  <span class="c1"># strip PID and 0-padding</span>
        <span class="p">},</span>
        <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PARTICIPANT</span><span class="o">.</span><span class="n">ID</span>
    <span class="p">),</span>
    <span class="n">keep_map</span><span class="p">(</span>
        <span class="n">in_col</span><span class="o">=</span><span class="s2">&quot;mother&quot;</span><span class="p">,</span>
        <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PARTICIPANT</span><span class="o">.</span><span class="n">MOTHER_ID</span>
    <span class="p">),</span>
    <span class="n">keep_map</span><span class="p">(</span>
        <span class="n">in_col</span><span class="o">=</span><span class="s2">&quot;father&quot;</span><span class="p">,</span>
        <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PARTICIPANT</span><span class="o">.</span><span class="n">FATHER_ID</span>
    <span class="p">),</span>
    <span class="n">value_map</span><span class="p">(</span>
        <span class="n">in_col</span><span class="o">=</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span>
        <span class="c1"># Don&#39;t worry about mother/father gender here.</span>
        <span class="c1"># We can create them in a later phase.</span>
        <span class="n">m</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">GENDER</span><span class="o">.</span><span class="n">FEMALE</span><span class="p">,</span>
            <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">GENDER</span><span class="o">.</span><span class="n">MALE</span>
        <span class="p">},</span>
        <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PARTICIPANT</span><span class="o">.</span><span class="n">GENDER</span>
    <span class="p">),</span>
    <span class="n">value_map</span><span class="p">(</span>
        <span class="n">in_col</span><span class="o">=</span><span class="s2">&quot;specimens&quot;</span><span class="p">,</span>
        <span class="n">m</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Split</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[,;]&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
        <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">BIOSPECIMEN</span><span class="o">.</span><span class="n">ID</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="n">value_map</span><span class="p">(</span>
            <span class="n">in_col</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>  <span class="c1"># age (hrs) (first)</span>
            <span class="n">m</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
            <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">EVENT_AGE_DAYS</span>
        <span class="p">),</span>
        <span class="n">melt_map</span><span class="p">(</span>
            <span class="n">var_name</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="n">map_for_vars</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;CLEFT_EGO&quot;</span><span class="p">:</span> <span class="s2">&quot;Cleft ego&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CLEFT_ID&quot;</span><span class="p">:</span> <span class="s2">&quot;Cleft id&quot;</span>
            <span class="p">},</span>
            <span class="n">value_name</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">OBSERVED</span><span class="p">,</span>
            <span class="n">map_for_values</span><span class="o">=</span><span class="n">observed_yes_no</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="n">value_map</span><span class="p">(</span>
            <span class="n">in_col</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>  <span class="c1"># age (hrs) (second)</span>
            <span class="n">m</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
            <span class="n">out_col</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">EVENT_AGE_DAYS</span>
        <span class="p">),</span>
        <span class="n">melt_map</span><span class="p">(</span>
            <span class="n">var_name</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="n">map_for_vars</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;EXTRA_EARDRUM&quot;</span><span class="p">:</span> <span class="s2">&quot;Extra eardrum&quot;</span>
            <span class="p">},</span>
            <span class="n">value_name</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">PHENOTYPE</span><span class="o">.</span><span class="n">OBSERVED</span><span class="p">,</span>
            <span class="n">map_for_values</span><span class="o">=</span><span class="n">observed_yes_no</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="modify-the-transform-module">
<h2>Modify the Transform module<a class="headerlink" href="#modify-the-transform-module" title="Permalink to this headline">¶</a></h2>
<p>Next we want to merge our extracted tables together to properly connect the
data needed for generating complete target entities.</p>
<p>For the quickstart, this will be performed by
<code class="docutils literal notranslate"><span class="pre">my_study/ingest_package_1/transform_module.py</span></code> which currently looks like
this:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">my_study/ingest_package_1/transform_module.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Auto-generated transform module</span>

<span class="sd">Replace the contents of transform_function with your own code</span>

<span class="sd">See documentation at</span>
<span class="sd">https://kids-first.github.io/kf-lib-data-ingest/ for information on</span>
<span class="sd">implementing transform_function.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.common.concept_schema</span> <span class="kn">import</span> <span class="n">CONCEPT</span>  <span class="c1"># noqa F401</span>

<span class="c1"># Use these merge funcs, not pandas.merge</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.common.pandas_utils</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa F401</span>
    <span class="n">merge_wo_duplicates</span><span class="p">,</span>
    <span class="n">outer_merge</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">kf_lib_data_ingest.config</span> <span class="kn">import</span> <span class="n">DEFAULT_KEY</span>


<span class="k">def</span> <span class="nf">transform_function</span><span class="p">(</span><span class="n">mapped_df_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge DataFrames in mapped_df_dict into 1 DataFrame if possible.</span>

<span class="sd">    Return a dict that looks like this:</span>

<span class="sd">    {</span>
<span class="sd">        DEFAULT_KEY: all_merged_data_df</span>
<span class="sd">    }</span>

<span class="sd">    If not possible to merge all DataFrames into a single DataFrame then</span>
<span class="sd">    you can return a dict that looks something like this:</span>

<span class="sd">    {</span>
<span class="sd">        &#39;&lt;name of target concept&gt;&#39;: df_for_&lt;target_concept&gt;,</span>
<span class="sd">        DEFAULT_KEY: all_merged_data_df</span>
<span class="sd">    }</span>

<span class="sd">    Target concept instances will be built from the default DataFrame unless</span>
<span class="sd">    another DataFrame is explicitly provided via a key, value pair in the</span>
<span class="sd">    output dict. They key must match the name of an existing target concept.</span>
<span class="sd">    The value will be the DataFrame to use when building instances of the</span>
<span class="sd">    target concept.</span>

<span class="sd">    A typical example would be:</span>

<span class="sd">    {</span>
<span class="sd">        &#39;family_relationship&#39;: family_relationship_df,</span>
<span class="sd">        &#39;default&#39;: all_merged_data_df</span>
<span class="sd">    }</span>

<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="n">df</span> <span class="o">=</span> <span class="n">mapped_df_dict</span><span class="p">[</span><span class="s2">&quot;extract_config.py&quot;</span><span class="p">]</span>
</span>
    <span class="c1"># df = outer_merge(</span>
    <span class="c1">#     mapped_df_dict[&#39;extract_config.py&#39;],</span>
    <span class="c1">#     mapped_df_dict[&#39;family_and_phenotype.py&#39;],</span>
    <span class="c1">#     on=CONCEPT.BIOSPECIMEN.ID,</span>
    <span class="c1">#     with_merge_detail_dfs=False</span>
    <span class="c1"># )</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">DEFAULT_KEY</span><span class="p">:</span> <span class="n">df</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Find the line near the bottom that says (highlighted above)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">mapped_df_dict</span><span class="p">[</span><span class="s2">&quot;extract_config.py&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>and replace that line with</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">outer_merge</span><span class="p">(</span>
    <span class="n">mapped_df_dict</span><span class="p">[</span><span class="s1">&#39;extract_config.py&#39;</span><span class="p">],</span>
    <span class="n">mapped_df_dict</span><span class="p">[</span><span class="s1">&#39;family_and_phenotype.py&#39;</span><span class="p">],</span>
    <span class="n">on</span><span class="o">=</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">BIOSPECIMEN</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
    <span class="n">with_merge_detail_dfs</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can also just uncomment the block immediately below it that contains the
same new code in a Python comment. This now defines <code class="docutils literal notranslate"><span class="pre">df</span></code> as the combination
of the two data files joined together according to the values in their
biospecimen identifier columns.</p>
</section>
<section id="test-again">
<h2>Test Again<a class="headerlink" href="#test-again" title="Permalink to this headline">¶</a></h2>
<p>Then again run</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ kidsfirst test my_study/ingest_package_1 --no_validate
</pre></div>
</div>
<p>Now you should see that it also pretends to load phenotypes from the new data
in addition to the rest of the information.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="design/overview.html" class="btn btn-neutral float-right" title="Design Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Kids First

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>